Arcanum project by lovable AI and Bolt AI
สามารถเข้าไปลองได้ที่ link : https://eikq-magic-mutter-77-1gt0.bolt.host
# Arcanum — แอปร่ายเวท “โค้ชออกเสียงภาษาอังกฤษ” (Beginner‑Friendly + Step‑by‑Step)

> **วัตถุประสงค์ใหม่ของโปรเจกต์:**  
> สร้าง **แอปช่วยออกเสียงภาษาอังกฤษ** ที่ **เพิ่มความสนุกด้วยระบบ “ร่ายเวท”** — ผู้ใช้พูด/ออกเสียงให้ถูกต้องเพื่อร่ายสกิล, ได้รับคะแนน/พลัง/เอฟเฟกต์ภาพ‑เสียง และรับฟีดแบ็กด้านการออกเสียงแบบเข้าใจง่าย

เอกสารนี้ตั้งใจให้ **คนที่ไม่เคยเขียนโค้ดมาก่อน** ก็ทำตามได้ทีละขั้น, รู้ว่าแอปทำงานอย่างไร, เล่นอย่างไร, และต้องแก้/ต่อยอดตรงไหน

---

## 0) Concept โดยย่อ (What is this app?)
- แอปเว็บ (Vite + TypeScript + Tailwind) + แบ็กเอนด์ `server.cjs` (Node) สำหรับงานที่ต้องซ่อน API Key/เรียก AI/ต่อฐานข้อมูล (Supabase)
- **เป้าหมายหลัก:** ช่วยฝึกออกเสียงภาษาอังกฤษ (เช่นคำศัพท์/วลี/สระ‑พยัญชนะยาก, stress, จังหวะ) โดยผูกกับกลไก **“สะสมพลัง/ร่ายเวท”**
- ใช้ไมโครโฟน → แปลงเสียงเป็นข้อความ + ตัวชี้วัดความมั่นใจ → ให้คะแนน → แสดงเอฟเฟกต์เกม → บันทึกสถิติ (ถ้าต่อฐานข้อมูล)

---

## 1) รันโปรเจกต์ครั้งแรก (ทีละขั้น)
> ทำบน Windows/Mac/Linux ได้เหมือนกัน

1) **ติดตั้งโปรแกรม** (ครั้งเดียว)  
   - [Node.js (LTS)](https://nodejs.org) — ใช้รัน/พัฒนาเว็บแอปสมัยใหม่  
   - [VS Code](https://code.visualstudio.com) — ไว้เปิด/แก้โค้ด  
   - (ทางเลือก) [Git](https://git-scm.com) — สำหรับ clone โค้ดจาก GitHub

2) **เอาโค้ดมาไว้ในเครื่อง**  
   - วิธีง่าย: กด **Code → Download ZIP** ที่หน้า GitHub แล้วแตกไฟล์  
   - วิธีมาตรฐาน: ใน VS Code กด `Ctrl+Shift+P` → `Git: Clone` → วางลิงก์ repo

3) **ติดตั้งไลบรารี**  
   เปิด **Terminal** ในโฟลเดอร์โปรเจกต์:  
   ```bash
   npm install
   ```

4) **รันฝั่งเว็บ (Frontend dev server)**  
   ```bash
   npm run dev
   ```
   เปิดเว็บเบราว์เซอร์ไปที่ลิงก์ที่ขึ้นใน Terminal (เช่น `http://localhost:5173`)

5) **รันฝั่งเซิร์ฟเวอร์ (ถ้าใช้ API/AI)**  
   เปิด Terminal อีกอัน:  
   ```bash
   node server.cjs
   ```

> เคล็ดลับ: ถ้ามีไฟล์ `bun.lockb` แปลว่าอาจใช้ **Bun** ได้ด้วย แต่สำหรับมือใหม่ใช้ `npm` จะง่ายที่สุด

---

## 2) วิธีเล่น (How to Play) — “โค้ชออกเสียง + ร่ายเวท”
1) เปิดเว็บ (`http://localhost:5173`) → กด **Start / Play**  
2) เบราว์เซอร์จะถามสิทธิ์ **ไมโครโฟน** → กดอนุญาต  
3) เลือก **ด่าน/คำศัพท์/คาถา** ที่อยากฝึก (เช่น *“water”, “three”, “think”, “world”* หรือคาถา *“Ignis”, “Aqua”* ฯลฯ)  
4) **พูดออกเสียง** ให้ชัด (ตามตัวอย่าง/เสียงต้นฉบับ ถ้ามี)  
5) ระบบจะให้ **คะแนน/พลังเวท/คอมโบ** ตามคุณภาพการออกเสียง และเล่น **เอฟเฟกต์ภาพ‑เสียง**  
6) ดู **ฟีดแบ็ก**: ข้อความที่ถูกรู้จำ, ตัวชี้วัดความมั่นใจ, เคล็ดลับแก้เสียง (ถ้ามี)  
7) ไปด่านต่อไปหรือเล่นซ้ำเพื่อทำสถิติให้ดีขึ้น

> หมายเหตุ: รายการคำ/คาถาที่ซัพพอร์ตจริง ขึ้นกับค่าที่ตั้งไว้ในไฟล์คอนฟิก (ดูหัวข้อ 5)

---

## 3) แอปทำงานยังไง (How it Works — High‑level Flow)
```
ไมค์ผู้ใช้
   ↓ (อนุญาตสิทธิ์)
ระบบรู้จำเสียง (ASR) → ได้ “ข้อความ + ความมั่นใจ (confidence)” 
   ↓
ตัวเทียบคำ/คาถา (Normalizer + Matcher + Rules)
   ↓
ตัวให้คะแนนการออกเสียง (Scoring) 
   ↓
เกมเพลย์ (พลัง, คอมโบ, คูลดาวน์, ศัตรูฯ) + เอฟเฟกต์ภาพ/เสียง
   ↓
ฟีดแบ็กให้ผู้เรียน (ผลออกเสียง, คำแนะนำ) + บันทึกสถิติ (Supabase)
```

- **Frontend (`src/`)**: UI, จัดการไมค์, แสดงผล/เอฟเฟกต์, เรียก API  
- **Backend (`server.cjs`)**: เรียกโมเดล/บริการรู้จำเสียง, เก็บคีย์ลับ, คำนวณเสริม, บันทึกฐานข้อมูล  
- **Supabase (`supabase/`)**: สคีมา/สคริปต์ที่เกี่ยวกับตารางสถิติ/โปรไฟล์ (ถ้าใช้)

> หมายเหตุด้านการ “ประเมินการออกเสียง”:  
> - ถ้าใช้ **Web Speech API ฝั่งเบราว์เซอร์** → เร็ว/ง่าย แต่ **ไม่ได้ให้ข้อมูลระดับโฟนีม** และคุณภาพ/สำเนียงขึ้นกับเบราว์เซอร์  
> - ถ้าใช้ **ASR ฝั่งเซิร์ฟเวอร์** (เช่น Whisper/บริการเชิงพาณิชย์) → แม่นกว่า/ควบคุมได้มากกว่า และสามารถต่อ **โมดูลประเมินออกเสียง (GOP/phoneme alignment)** ได้ในอนาคต

---

## 4) จะแก้/เพิ่มคอนเทนต์ภาษาอังกฤษตรงไหน (Where to Modify)
> ชื่อไฟล์จริงในสาขาของคุณอาจต่างกันได้ — ต่อไปนี้คือ **โครงแนะนำ** (สร้างไฟล์เพิ่มได้ถ้ายังไม่มี)

- `src/config/spells.ts`  
  - รายการ **คาถา/คำศัพท์** ที่ใช้ฝึก (text, level, หมวดเสียงที่ยาก, คะแนนพื้นฐาน, คอมโบ)  
- `src/lib/recognition.ts`  
  - ส่วนติดต่อ **ไมค์ + ASR ฝั่งเว็บ** (เริ่ม/หยุดฟัง, ตัวเลือกภาษา en‑US/en‑GB, ตั้งเวลา timeout)  
- `src/lib/scoring.ts`  
  - กฎให้คะแนนอย่างง่าย (เช่น เทียบข้อความเป้าหมายกับผลรู้จำ, เว้นเครื่องหมาย, lowercase, เปรียบใกล้เคียงด้วย Levenshtein)  
- `src/game/logic.ts`  
  - แปลงคะแนน → **พลัง/คอมโบ/คูลดาวน์**, สุ่มเหตุการณ์, จัดการ HP ศัตรู  
- `src/components/FeedbackPanel.tsx`  
  - แสดงผลลัพธ์/คำแนะนำผู้เรียน (stress, speed, ตำแหน่งเสียงตัวอย่าง)  
- `server.cjs`  
  - **Endpoints** เช่น `/api/transcribe`, `/api/score`  
  - เรียก **ASR/AI ฝั่งเซิร์ฟเวอร์** และเชื่อม **Supabase** เพื่อเก็บสถิติ

> เคล็ดลับค้นไฟล์ไว ๆ: กด `Ctrl/Cmd + Shift + F` แล้วค้นคำว่า `spells`, `recognition`, `score`, `app.post(`, `process.env`

---

## 5) ตั้งค่า .env (ตัวอย่างที่พบบ่อย)
สร้างไฟล์ `.env` ระดับรูทโปรเจกต์:

```ini
# Frontend (Vite ต้องขึ้นต้น VITE_)
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...

# Backend
OPENAI_API_KEY=...        # ถ้าเรียกโมเดล/บริการฝั่งเซิร์ฟเวอร์
ASR_PROVIDER=web          # web | whisper | vendorX  (เลือกกลยุทธ์รู้จำเสียง)
SUPABASE_SERVICE_ROLE=... # ถ้าจะเขียนฐานข้อมูล
PORT=5174                 # พอร์ต server.cjs
```
ดูว่าโปรเจกต์คุณเรียกใช้อะไรจริงโดยค้น `process.env` ใน `server.cjs`

---

## 6) ข้อเสีย/ข้อจำกัดของแอป (ปัจจุบัน)
- **ประเมินเสียงไม่ละเอียดระดับโฟนีม** หากพึ่ง Web Speech API → ใช้ได้ดีในระดับคำ/วลี แต่ **ยังไม่ใช่เครื่องมือทางภาษาศาสตร์/คลินิก**  
- **ความแม่น/สำเนียงขึ้นกับเบราว์เซอร์/อุปกรณ์** (en‑US มักแม่นกว่า accents อื่น)  
- **สภาพแวดล้อมเสียงรบกวนมีผลมาก** — ห้องก้อง/ไมค์ไกล/เสียงดังจะลดคุณภาพ  
- **Latency/เน็ต**: หากใช้ ASR ฝั่งเซิร์ฟเวอร์ → มีดีเลย์ตามเครือข่าย  
- **ความเป็นส่วนตัว**: ถ้าเปิดบันทึกเสียงเพื่อ training/สถิติ ต้องแจ้งผู้ใช้และจัดเก็บอย่างปลอดภัย  
- **การเข้าถึง (Accessibility)**: ผู้ใช้ที่มีข้อจำกัดด้านการพูดหรืออุปกรณ์ไม่มีไมค์จะใช้งานไม่ได้เต็มที่  
- **มือถือบางรุ่น/เบราว์เซอร์บางตัว** (โดยเฉพาะ iOS) มีข้อจำกัดการเริ่มฟังอัตโนมัติ — ต้องอาศัยการคลิกเริ่มฟังทุกครั้ง

---

## 7) บั๊กที่ยังมี/อาการที่พบบ่อย (ควรตรวจในสาขาของคุณ)
> หัวข้อนี้สรุป **อาการที่มักพบในโปรเจกต์แนวนี้** (และบางส่วนเคยถูกรายงานในเวอร์ชันก่อน ๆ ของโปรเจกต์คล้ายกัน) — กรุณาตรวจทานกับสาขาปัจจุบันของคุณจริงอีกครั้ง

- **รอบแรกศัตรู/บอทไม่ทำงาน** จนกว่าจะผ่านหนึ่งเทิร์น (init state/loop ไม่เริ่ม)  
- **ไมค์เริ่มฟังแล้วหยุดเองเร็วไป** เมื่อเจอช่วงเงียบ (silence timeout) → ผู้ใช้พูดไม่ทัน  
- **รู้จำเฉพาะ “คาถา” แต่ไม่โชว์ข้อความเต็ม** ที่ผู้ใช้พูด (UI ไม่แสดง transcript เต็ม)  
- **ปุ่ม “กลับเมนู/รีสตาร์ท” ไม่มี/ไม่ทำงาน** หลังแพ้/ชนะ → UX ตัน  
- **เอฟเฟกต์ภาพ/เสียงไม่เล่นบ้างเป็นบางครั้ง** (race condition/การ unload เสียงช้า)  
- **สเกลพลังตามความดังผิดเพี้ยน** (ไมค์ต่างรุ่นให้ระดับเสียงไม่เท่ากัน → ต้องทำ calibration)  
- **deny ไมค์แล้วแอปค้าง** (กรณีผู้ใช้กด “ไม่อนุญาต”)  
- **เรียก /api แล้วได้ 401/403 หรือ CORS error** (ตั้งค่า .env/Origin ยังไม่ถูก)

**แนวทางแก้โดยย่อ**
- เริ่มเกม/ศัตรู: ตรวจลูปหลัก, ตั้งค่า state เริ่มต้นใน `src/game/logic.ts`  
- ฟังเสียง: เพิ่มปุ่ม Start/Stop ชัดเจน, ตั้งค่า timeout/continuous listening, debounce  
- Transcript: ให้ UI โชว์ทั้ง “ข้อความที่ได้” และ “confidence”  
- ปุ่มเมนู: เพิ่มปุ่ม Back to Menu/Play Again + ตรวจ router/สถานะรีเซ็ต  
- เสียง/ภาพ: โหลดล่วงหน้าหรือใช้ state คุมการเล่นให้ deterministic  
- สเกลความดัง: ทำ **ไมค์ calibration** (+ เก็บค่า baseline ต่อผู้ใช้)  
- สิทธิ์ไมค์: จัดการ error + เคสผู้ใช้ไม่อนุญาตให้ครบ  
- CORS/401: ตรวจ `server.cjs` ให้อนุญาต origin ที่ถูกต้อง + คีย์ `.env` ครบ

---

## 8) ระบบที่ “ยังไม่เปิดใช้/ยังไม่เสร็จ” (ตัวอย่างระบุให้ชัด)
> โปรดปรับตามสถานะจริงของสาขาคุณ — ด้านล่างคือรายการที่มัก “ยังไม่พร้อม” ในโครงการลักษณะนี้

- **การประเมินออกเสียงแบบโฟนีม (GOP/phoneme alignment)** — *ยังไม่เปิดใช้*  
- **ดัชนี stress/intonation แบบละเอียด** — *ยังไม่เปิดใช้*  
- **โหมด Multiplayer / PvP** — *ยังไม่เปิดใช้*  
- **Leaderboard/โปรไฟล์ผู้ใช้ + เก็บสถิติครบวงจร** — *ยังไม่เปิดใช้*  
- **โหมดออฟไลน์/PWA เต็มรูปแบบ** — *ยังไม่เปิดใช้*  
- **ระบบ Tutorial แบบโต้ตอบ/เสียงตัวอย่างเทียบ** — *ยังไม่เปิดใช้*  
- **หน้า Settings (เลือกสำเนียง en‑US/en‑GB, ระดับความยาก, เปิด/ปิดคำใบ้)** — *ยังไม่เปิดใช้*

> คุณสามารถสร้าง “เช็กลิสต์ Roadmap” ใน `README` แล้วติ๊กสถานะบนแต่ละ release เพื่อสื่อสารกับทีม/ผู้ใช้

---

## 9) ทดสอบ, Build, Deploy
```bash
npm test         # ถ้าตั้งเทสต์ไว้
npm run build    # บิลด์โปรดักชัน (ไฟล์พร้อมดีพลอย)
npm run preview  # พรีวิวไฟล์บิลด์
```
- Frontend → Vercel / Netlify / Cloudflare Pages  
- Backend (`server.cjs`) → Railway / Render / Fly.io / Cloud Run  
> ตั้งค่า ENV บนโฮสต์จริงให้ตรงกับ `.env` ในเครื่อง

---

## 10) TL;DR (สรุปสั้นที่สุด)
- เป้าหมาย: **โค้ชออกเสียงอังกฤษ** ที่ **สนุกเหมือนเกมร่ายเวท**
- เริ่ม: `npm install` → `npm run dev` (+ `node server.cjs`)  
- แก้ภาษา/คาถา/คะแนน: `src/config/spells.ts`, `src/lib/scoring.ts`  
- AI/ASR/DB: `server.cjs` + `supabase/`  
- ข้อเสีย/ช่องโหว่: ไม่มีโฟนีมสกอร์, แพ้เสียงรบกวน, iOS ต้องกดเริ่มฟังเอง, CORS/ไมค์/Latency  
- บั๊กที่พบบ่อย: รอบแรกนิ่ง, ฟังหยุดไว, ไม่โชว์ transcript, ปุ่มเมนูขาด, เอฟเฟกต์สะดุด, สเกลความดังเพี้ยน, deny ไมค์แล้วค้าง
